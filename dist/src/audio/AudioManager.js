import{AUDIO as t}from"../constants.js";export class AudioManager{constructor(){this.audioContext=null,this.sounds=new Map,this.masterVolume=.7,this.isEnabled=!0,this.isInitialized=!1,this.initializeAudioContext(),this.generateSounds()}initializeAudioContext(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.audioContext.createGain(),this.masterGain.gain.value=this.masterVolume,this.masterGain.connect(this.audioContext.destination),this.isInitialized=!0}catch(t){console.warn("Web Audio API not supported, audio disabled:",t),this.isEnabled=!1}}async resumeAudioContext(){this.audioContext&&"suspended"===this.audioContext.state&&await this.audioContext.resume()}generateSounds(){this.isEnabled&&(this.generateThrusterSound(),this.generateCollisionSound(),this.generateAmbientHum(),this.generateLaserSound(),this.generateWeaponRechargeSound())}generateThrusterSound(){const e=this.createNoiseBuffer(t.AMBIENT_VOLUME,(e,a)=>(Math.sin(e*t.FREQUENCY_MID*a)*t.VOLUME_LOW+(Math.random()-t.FADE_DURATION)*t.AMBIENT_VOLUME)*Math.exp(-a*t.ENVELOPE_DECAY)*t.THRUSTER_VOLUME);this.sounds.set("thruster",e)}generateCollisionSound(){const e=this.createNoiseBuffer(t.FADE_DURATION,(e,a)=>{const i=Math.sin(e*t.FREQUENCY_HIGH*a)*Math.exp(-a*t.IMPACT_DECAY),s=Math.sin(e*t.FREQUENCY_MID*a)*Math.exp(-a*t.RUMBLE_DECAY),n=(Math.random()-t.FADE_DURATION)*t.NOISE_MIX*Math.exp(-a*t.NOISE_DECAY);return(i*t.IMPACT_MIX+s*t.AMBIENT_VOLUME+n)*t.SOUND_MIX});this.sounds.set("collision",e)}generateAmbientHum(){const e=this.createNoiseBuffer(2,(e,a)=>(Math.sin(e*t.FREQUENCY_LOW*a)*t.HUM_MIX+Math.sin(e*t.HUM_FREQUENCY*a)*t.FADE_DURATION)*(1+Math.sin(e*t.FADE_DURATION*a)*t.VOLUME_LOW)*t.AMBIENT_VOLUME);this.sounds.set("ambient",e)}generateLaserSound(){const e=this.createNoiseBuffer(t.VOLUME_HIGH,(e,a)=>{const i=Math.sin(e*t.FREQUENCY_HIGH*t.LASER_FREQUENCY_MULT*a)*Math.exp(-a*t.LASER_BEAM_DECAY),s=Math.sin(e*t.FREQUENCY_HIGH*t.LASER_ZAP_FREQUENCY_MULT*a)*Math.exp(-a*t.LASER_ZAP_DECAY),n=(Math.random()-t.FADE_DURATION)*t.VOLUME_LOW*Math.exp(-a*t.LASER_ENERGY_DECAY);return(i*t.SOUND_MIX+s*t.VOLUME_HIGH+n)*t.LASER_VOLUME});this.sounds.set("laser",e)}generateWeaponRechargeSound(){const e=this.createNoiseBuffer(.6,(e,a)=>(.4*(Math.sin(e*t.FREQUENCY_MID*a*(1+2*a))*(3*a))+Math.sin(e*t.FREQUENCY_HIGH*a*3)*Math.sin(8*e*a)*.2+.3*Math.sin(e*t.FREQUENCY_LOW*a)*(1-Math.exp(4*-a)))*Math.min(1,4*a)*t.VOLUME_MEDIUM);this.sounds.set("weaponRecharge",e)}createNoiseBuffer(t,e){if(!this.audioContext)return null;const a=this.audioContext.sampleRate,i=a*t,s=this.audioContext.createBuffer(1,i,a),n=s.getChannelData(0);for(let t=0;t<i;t++){const i=t/a,s=2*Math.PI/a;n[t]=e(s,i)}return s}play(e,a={}){if(!this.isEnabled||!this.isInitialized)return null;this.resumeAudioContext();const i=this.sounds.get(e);if(!i)return console.warn(`Sound '${e}' not found`),null;const s=this.audioContext.createBufferSource(),n=this.audioContext.createGain();return s.buffer=i,s.connect(n),n.connect(this.masterGain),n.gain.value=a.volume||1,a.loop&&(s.loop=!0),a.playbackRate&&(s.playbackRate.value=a.playbackRate),s.start(0),!a.loop&&a.duration&&s.stop(this.audioContext.currentTime+a.duration),{source:s,gainNode:n,stop:()=>s.stop(),setVolume:t=>{n.gain.value=t},fadeOut:(e=t.FADE_DURATION)=>{n.gain.exponentialRampToValueAtTime(t.RAMP_TIME,this.audioContext.currentTime+e),setTimeout(()=>s.stop(),e*t.SUSTAIN_TIME)}}}playThruster(e=1){return this.play("thruster",{volume:e*t.VOLUME_HIGH,playbackRate:t.THRUSTER_VOLUME+e*t.PLAYBACK_MIN,loop:!0})}playCollision(e=1){return this.play("collision",{volume:e*t.COLLISION_VOLUME,playbackRate:t.PLAYBACK_BASE+Math.random()*t.VOLUME_HIGH})}playAmbient(){return this.play("ambient",{volume:t.AMBIENT_VOLUME,loop:!0})}playLaser(e=1){return this.play("laser",{volume:e*t.LASER_VOLUME,playbackRate:t.PLAYBACK_BASE+Math.random()*t.VOLUME_LOW})}playWeaponRecharge(){return this.play("weaponRecharge",{volume:t.VOLUME_MEDIUM,playbackRate:t.PLAYBACK_BASE+.2*Math.random()})}setMasterVolume(t){this.masterVolume=Math.max(0,Math.min(1,t)),this.masterGain&&(this.masterGain.gain.value=this.masterVolume)}enable(){this.isEnabled=!0,this.isInitialized||(this.initializeAudioContext(),this.generateSounds())}disable(){this.isEnabled=!1}stopAll(){}}