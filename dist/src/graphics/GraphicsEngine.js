import{GRAPHICS as t}from"../constants.js";export class GraphicsEngine{constructor(t){this.svg=t,this.layers=new Map,this.defs=this.svg.querySelector("defs")||this.createDefs(),this.idCounter=0}createDefs(){const t=this.createElement("defs");return this.svg.appendChild(t),t}createElement(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}generateId(t="element"){return`${t}_${++this.idCounter}`}createLayer(t,e=0){const r=this.createElement("g");return r.setAttribute("id",`layer_${t}`),r.setAttribute("data-layer",t),r.style.zIndex=e,this.layers.set(t,r),this.svg.appendChild(r),r}getLayer(t){return this.layers.has(t)?this.layers.get(t):this.createLayer(t)}createCircle(t,e,r,i={}){const a=this.createElement("circle");return a.setAttribute("cx",t),a.setAttribute("cy",e),a.setAttribute("r",r),Object.entries(i).forEach(([t,e])=>{a.setAttribute(t,e)}),a}createRect(t,e,r,i,a={}){const s=this.createElement("rect");return s.setAttribute("x",t),s.setAttribute("y",e),s.setAttribute("width",r),s.setAttribute("height",i),Object.entries(a).forEach(([t,e])=>{s.setAttribute(t,e)}),s}createPath(t,e={}){const r=this.createElement("path");return r.setAttribute("d",t),Object.entries(e).forEach(([t,e])=>{r.setAttribute(t,e)}),r}createGroup(t={}){const e=this.createElement("g");return Object.entries(t).forEach(([t,r])=>{e.setAttribute(t,r)}),e}createGradient(t,e,r={}){const i=this.generateId("gradient"),a=this.createElement("radial"===t?"radialGradient":"linearGradient");return a.setAttribute("id",i),Object.entries(r).forEach(([t,e])=>{a.setAttribute(t,e)}),e.forEach(t=>{const e=this.createElement("stop");e.setAttribute("offset",t.offset),e.setAttribute("stop-color",t.color),void 0!==t.opacity&&e.setAttribute("stop-opacity",t.opacity),a.appendChild(e)}),this.defs.appendChild(a),i}createStarField(e,r={width:t.DEFAULT_CANVAS_WIDTH,height:t.DEFAULT_CANVAS_HEIGHT}){const i=this.createGroup({id:"starField"});for(let a=0;a<e;a++){const e=Math.random()*r.width,a=Math.random()*r.height,s=this.selectStarType(),A=t.STAR_TYPES[s],o=Math.random()*(t.STAR_SIZE_MAX-t.STAR_SIZE_MIN)+t.STAR_SIZE_MIN,T=o*A.sizeMultiplier,_=this.createStar(e,a,T,A.color,s);if(i.appendChild(_),Math.random()<t.STAR_BINARY_CHANCE){const r=this.selectStarType(),s=t.STAR_TYPES[r],A=o*t.STAR_COMPANION_SIZE_RATIO*s.sizeMultiplier,T=Math.random()*Math.PI*t.FULL_CIRCLE,_=e+Math.cos(T)*t.STAR_BINARY_SEPARATION,n=a+Math.sin(T)*t.STAR_BINARY_SEPARATION,l=this.createStar(_,n,A,s.color,r);i.appendChild(l)}}return i}selectStarType(){const e=Math.random()*t.STAR_CUMULATIVE_RARITY;let r=0;for(const[i,a]of Object.entries(t.STAR_TYPES))if(r+=a.rarity,e<=r)return i;return"M"}createStar(e,r,i,a,s){const A=Math.random()*(t.STAR_OPACITY_MAX-t.STAR_OPACITY_MIN)+t.STAR_OPACITY_MIN,o=this.createGroup({transform:`translate(${e}, ${r})`}),T=this.createCircle(0,0,i,{fill:a,opacity:A,"data-star-type":s});if(i>t.MATH_PI_MULTIPLIER||"O"===s||"B"===s){const e=this.createCircle(0,0,i*t.RATIO_BINARY_SEPARATION,{fill:a,opacity:A*t.RATIO_SIZE_SMALL,filter:"blur(1px)"});o.appendChild(e)}return o.appendChild(T),Math.random()<t.STAR_TWINKLE_CHANCE&&this.addTwinkleAnimation(T),o}addTwinkleAnimation(e){const r=this.createElement("animate");r.setAttribute("attributeName","opacity"),r.setAttribute("values",`${e.getAttribute("opacity")};${parseFloat(e.getAttribute("opacity"))*(1-t.STAR_TWINKLE_INTENSITY)};${e.getAttribute("opacity")}`),r.setAttribute("dur",`${t.STAR_TWINKLE_MIN_DURATION+Math.random()*t.STAR_TWINKLE_MAX_DURATION}s`),r.setAttribute("repeatCount","indefinite"),e.appendChild(r)}createAsteroidField(e,r={width:t.DEFAULT_CANVAS_WIDTH,height:t.DEFAULT_CANVAS_HEIGHT}){const i=this.createGroup({id:"asteroidField"});for(let a=0;a<e;a++){const e=Math.random()*r.width,a=Math.random()*r.height,s=Math.random()*t.ASTEROID_SIZE_RANGE+t.ASTEROID_SIZE_MIN,A=this.createAsteroid(e,a,s);i.appendChild(A)}return i}createAsteroid(e,r,i,a={}){const s=this.createGroup({transform:`translate(${e}, ${r})`,...a}),A=t.ASTEROID_VERTICES+Math.floor(Math.random()*t.ASTEROID_VERTEX_VARIANCE);let o="";for(let e=0;e<A;e++){const r=e/A*2*Math.PI,a=i*(t.ASTEROID_RADIUS_MIN+Math.random()*t.ASTEROID_RADIUS_MAX),s=Math.cos(r)*a,T=Math.sin(r)*a;o+=0===e?`M ${s} ${T}`:` L ${s} ${T}`}o+=" Z";const T=this.createPath(o,{fill:"#8b7355",stroke:"#654321","stroke-width":t.ASTEROID_STROKE_WIDTH,opacity:t.ASTEROID_OPACITY}),_=this.createPath(o,{fill:"none",stroke:"#a0926b","stroke-width":t.ASTEROID_HIGHLIGHT_WIDTH,opacity:t.ASTEROID_HIGHLIGHT_OPACITY,transform:`translate(-${i*t.ASTEROID_HIGHLIGHT_OFFSET}, -${i*t.ASTEROID_HIGHLIGHT_OFFSET})`});return s.appendChild(T),s.appendChild(_),s}createSpaceship(e,r,i=t.SPACESHIP_DEFAULT_SIZE,a={}){const s=this.createGroup({transform:`translate(${e}, ${r})`,...a}),A=this.createPath(`M 0 -${i} L ${i*t.SPACESHIP_HULL_WING_RATIO} ${i} L 0 ${i*t.SPACESHIP_HULL_BODY_RATIO} L -${i*t.SPACESHIP_HULL_WING_RATIO} ${i} Z`,{fill:"#4a90e2",stroke:"#ffffff","stroke-width":t.SPACESHIP_STROKE_WIDTH}),o=this.createCircle(0,i*t.SPACESHIP_ENGINE_RATIO,i*t.SPACESHIP_ENGINE_SIZE_RATIO,{fill:"#ff4444",opacity:.8}),T=this.createGroup({id:"mainThruster",opacity:0}),_=this.createPath(`M -${i*t.SPACESHIP_THRUSTER_MAIN_WIDTH} ${i*t.SPACESHIP_THRUSTER_OPACITY} L 0 ${i*t.SPACESHIP_THRUSTER_MAIN_HEIGHT} L ${i*t.SPACESHIP_THRUSTER_MAIN_WIDTH} ${i*t.SPACESHIP_THRUSTER_OPACITY} Z`,{fill:"#ff6600",opacity:t.SPACESHIP_THRUSTER_FLAME_OPACITY}),n=this.createPath(`M -${i*t.SPACESHIP_THRUSTER_CORE_WIDTH} ${i*t.SPACESHIP_THRUSTER_INNER_OPACITY} L 0 ${i*t.SPACESHIP_THRUSTER_CORE_HEIGHT} L ${i*t.SPACESHIP_THRUSTER_CORE_WIDTH} ${i*t.SPACESHIP_THRUSTER_INNER_OPACITY} Z`,{fill:"#ffaa00",opacity:t.SPACESHIP_THRUSTER_INNER_OPACITY}),l=this.createPath(`M -${Number(i)*t.SPACESHIP_THRUSTER_INNER_WIDTH} ${Number(i)*t.SPACESHIP_THRUSTER_CORE_HEIGHT_OFFSET} L 0 ${Number(i)*t.SPACESHIP_THRUSTER_INNER_HEIGHT} L ${Number(i)*t.SPACESHIP_THRUSTER_INNER_WIDTH} ${Number(i)*t.SPACESHIP_THRUSTER_CORE_HEIGHT_OFFSET} Z`,{fill:"#ffffff",opacity:t.SPACESHIP_THRUSTER_FLAME_OPACITY});T.appendChild(_),T.appendChild(n),T.appendChild(l);const E=this.createGroup({id:"leftThruster",opacity:0}),c=this.createPath(`M -${i*t.SPACESHIP_THRUSTER_SIDE_WIDTH} -${i*t.SPACESHIP_THRUSTER_SIDE_HEIGHT} L -${i*t.SPACESHIP_THRUSTER_SIDE_LENGTH} 0 L -${i*t.SPACESHIP_THRUSTER_SIDE_WIDTH} ${i*t.SPACESHIP_THRUSTER_SIDE_HEIGHT} Z`,{fill:"#0088ff",opacity:t.SPACESHIP_THRUSTER_SIDE_OPACITY});E.appendChild(c);const h=this.createGroup({id:"rightThruster",opacity:0}),I=this.createPath(`M ${i*t.SPACESHIP_THRUSTER_SIDE_WIDTH} -${i*t.SPACESHIP_THRUSTER_SIDE_HEIGHT} L ${i*t.SPACESHIP_THRUSTER_SIDE_LENGTH} 0 L ${i*t.SPACESHIP_THRUSTER_SIDE_WIDTH} ${i*t.SPACESHIP_THRUSTER_SIDE_HEIGHT} Z`,{fill:"#0088ff",opacity:t.SPACESHIP_THRUSTER_SIDE_OPACITY});return h.appendChild(I),s.appendChild(A),s.appendChild(o),s.appendChild(T),s.appendChild(E),s.appendChild(h),s}updateSpaceshipThrusters(e,r,i=!1){const a=e.querySelector("#mainThruster"),s=e.querySelector("#leftThruster"),A=e.querySelector("#rightThruster");if(!a||!s||!A)return;const o=i?t.SPACESHIP_THRUSTER_BOOST_OPACITY:t.SPACESHIP_THRUSTER_BASE_OPACITY,T=t.SPACESHIP_THRUSTER_FADE_SPEED;if(r.y>0)a.setAttribute("opacity",o);else{const t=parseFloat(a.getAttribute("opacity"))||0,e=Math.max(0,t-T);a.setAttribute("opacity",e)}if(r.x>0)s.setAttribute("opacity",o*t.SPACESHIP_THRUSTER_SIDE_OPACITY);else{const t=parseFloat(s.getAttribute("opacity"))||0,e=Math.max(0,t-T);s.setAttribute("opacity",e)}if(r.x<0)A.setAttribute("opacity",o*t.SPACESHIP_THRUSTER_SIDE_OPACITY);else{const t=parseFloat(A.getAttribute("opacity"))||0,e=Math.max(0,t-T);A.setAttribute("opacity",e)}}createPlanet(e,r,i,a={}){const s=this.createGroup({transform:`translate(${e}, ${r})`,...a}),A=a.surfaceColor||"#8b4513",o=a.coreColor||"#654321",T=a.atmosphereColor||"#4444ff",_=this.createGradient("radial",[{offset:"0%",color:A},{offset:"70%",color:o},{offset:"100%",color:"#2c1810"}],{cx:"30%",cy:"30%"}),n=this.createCircle(0,0,i,{fill:`url(#${_})`,stroke:T,"stroke-width":2,opacity:t.RATIO_OPACITY_HIGH});return s.appendChild(n),this.addPlanetCraters(s,i,A),this.addPlanetContinents(s,i,A),this.addPlanetAtmosphere(s,i,T),s}addPlanetCraters(e,r,i){const a=t.PLANET_CRATER_MIN+Math.floor(Math.random()*t.PLANET_CRATER_MAX);for(let s=0;s<a;s++){const a=Math.random()*Math.PI*t.FULL_CIRCLE,s=Math.random()*r*t.PLANET_CRATER_DISTANCE_MAX,A=Math.cos(a)*s,o=Math.sin(a)*s,T=Math.random()*r*t.PLANET_CRATER_SIZE_MAX+r*t.PLANET_CRATER_SIZE_MIN,_=this.createCircle(A,o,T,{fill:this.darkenColor(i,t.PLANET_DARKEN_FACTOR),opacity:.8}),n=this.createCircle(A,o,T*t.PLANET_CRATER_RIM_RATIO,{fill:"none",stroke:this.lightenColor(i,t.PLANET_LIGHTEN_FACTOR),"stroke-width":1,opacity:.6});e.appendChild(_),e.appendChild(n)}}addPlanetContinents(e,r,i){const a=t.PLANET_CONTINENT_MIN+Math.floor(Math.random()*t.PLANET_CONTINENT_MAX);for(let s=0;s<a;s++){const a=Math.random()*Math.PI*t.FULL_CIRCLE,s=Math.random()*r*t.PLANET_CONTINENT_DISTANCE_MAX,A=Math.cos(a)*s,o=Math.sin(a)*s,T=t.PLANET_CONTINENT_POINTS_MIN+Math.floor(Math.random()*t.PLANET_CONTINENT_POINTS_MAX);let _="";for(let e=0;e<T;e++){const i=e/T*2*Math.PI,a=r*(t.PLANET_CONTINENT_RADIUS_MIN+Math.random()*t.PLANET_CONTINENT_RADIUS_MAX),s=A+Math.cos(i)*a,n=o+Math.sin(i)*a;_+=0===e?`M ${s} ${n}`:` L ${s} ${n}`}_+=" Z";const n=this.createPath(_,{fill:this.lightenColor(i,t.PLANET_LIGHTEN_FACTOR),opacity:t.PLANET_CONTINENT_OPACITY,"clip-path":`circle(${r}px at 0px 0px)`});e.appendChild(n)}}addPlanetAtmosphere(e,r,i){const a=this.createGradient("radial",[{offset:"85%",color:i,opacity:0},{offset:"100%",color:i,opacity:.3}],{cx:"50%",cy:"50%"}),s=this.createCircle(0,0,r*t.GLOW_INTENSITY,{fill:`url(#${a})`,opacity:.6});e.appendChild(s)}darkenColor(e,r){if(e.startsWith("#")){const i=e.slice(1);return`rgb(${Math.floor(parseInt(i.slice(t.HEX_RED_START,t.HEX_RED_END),16)*(1-r))}, ${Math.floor(parseInt(i.slice(t.HEX_GREEN_START,t.HEX_GREEN_END),16)*(1-r))}, ${Math.floor(parseInt(i.slice(t.HEX_BLUE_START,t.HEX_BLUE_END),16)*(1-r))})`}return e}lightenColor(e,r){if(e.startsWith("#")){const i=e.slice(1);return`rgb(${Math.min(t.COLOR_MAX,Math.floor(parseInt(i.slice(t.HEX_RED_START,t.HEX_RED_END),16)*(1+r)))}, ${Math.min(t.COLOR_MAX,Math.floor(parseInt(i.slice(t.HEX_GREEN_START,t.HEX_GREEN_END),16)*(1+r)))}, ${Math.min(t.COLOR_MAX,Math.floor(parseInt(i.slice(t.HEX_BLUE_START,t.HEX_BLUE_END),16)*(1+r)))})`}return e}createSpaceStation(e,r,i=t.STATION_DEFAULT_SIZE,a={}){const s=this.createGroup({transform:`translate(${e}, ${r})`,...a}),A=this.createCircle(0,0,i*t.STATION_HUB_RATIO,{fill:"#666666",stroke:"#aaaaaa","stroke-width":2}),o=this.createCircle(0,0,i*t.STATION_RING_RATIO,{fill:"none",stroke:"#888888","stroke-width":i*t.STATION_RING_WIDTH,opacity:t.STATION_RING_OPACITY});for(let e=0;e<t.STATION_DOCKING_PORTS;e++){const r=e*t.ANGLE_90*Math.PI/t.ANGLE_180,a=Math.cos(r)*i,A=Math.sin(r)*i,o=this.createRect(a-i*t.STATION_PORT_WIDTH,A-i*t.STATION_PORT_HEIGHT,i*t.STATION_PORT_LENGTH,i*t.STATION_PORT_WIDTH,{fill:"#4a90e2",stroke:"#ffffff","stroke-width":1,transform:`rotate(${e*t.ANGLE_90}, ${a}, ${A})`});s.appendChild(o)}for(let e=0;e<t.STATION_SOLAR_PANELS;e++){const r=e*t.ANGLE_60*Math.PI/t.ANGLE_180,a=Math.cos(r)*i*t.STATION_PANEL_DISTANCE,A=Math.sin(r)*i*t.STATION_PANEL_DISTANCE,o=this.createRect(a-i*t.STATION_PANEL_WIDTH,A-i*t.STATION_PANEL_HEIGHT,i*t.STATION_PANEL_LENGTH,i*t.STATION_PANEL_WIDTH,{fill:"#1a1a3a",stroke:"#4444ff","stroke-width":1,opacity:t.STATION_PANEL_OPACITY,transform:`rotate(${e*t.ANGLE_60}, ${a}, ${A})`});s.appendChild(o)}const T=this.createRect(-i*t.STATION_COMM_WIDTH,-i*t.STATION_COMM_HEIGHT,i*t.STATION_COMM_LENGTH,i*t.STATION_COMM_WIDTH_RATIO,{fill:"#cccccc",stroke:"#ffffff","stroke-width":1});s.appendChild(A),s.appendChild(o),s.appendChild(T);const _=this.createCircle(-i*t.STATION_NAV_LIGHT_RATIO,0,i*t.STATION_NAV_LIGHT_SIZE,{fill:"#ff4444",opacity:t.STATION_NAV_LIGHT_OPACITY}),n=this.createCircle(i*t.STATION_NAV_LIGHT_RATIO,0,i*t.STATION_NAV_LIGHT_SIZE,{fill:"#44ff44",opacity:t.STATION_NAV_LIGHT_OPACITY});return s.appendChild(_),s.appendChild(n),s}createJumpGate(e,r,i=t.GATE_DEFAULT_SIZE,a={}){const s=this.createGroup({transform:`translate(${e}, ${r})`,...a}),A=this.createCircle(0,0,i,{fill:"none",stroke:"#00ffff","stroke-width":i*t.GATE_OUTER_STROKE_RATIO,opacity:t.GATE_OUTER_OPACITY,"stroke-dasharray":`${i*t.GATE_DASH_ARRAY_LONG} ${i*t.GATE_DASH_ARRAY_SHORT}`}),o=this.createCircle(0,0,i*t.GATE_INNER_RATIO,{fill:"none",stroke:"#ffffff","stroke-width":i*t.GATE_INNER_STROKE_RATIO,opacity:t.GATE_INNER_OPACITY}),T=this.createCircle(0,0,i*t.GATE_CORE_RATIO,{fill:"#00ffff",opacity:t.GATE_CORE_OPACITY,"fill-rule":"evenodd"});for(let e=0;e<t.GATE_STRUT_COUNT;e++){const r=e*t.ANGLE_90*Math.PI/t.ANGLE_180,a=Math.cos(r)*i*t.GATE_STRUT_INNER_RATIO,A=Math.sin(r)*i*t.GATE_STRUT_INNER_RATIO,o=Math.cos(r)*i*t.GATE_STRUT_OUTER_RATIO,T=Math.sin(r)*i*t.GATE_STRUT_OUTER_RATIO,_=this.createElement("line");_.setAttribute("x1",a),_.setAttribute("y1",A),_.setAttribute("x2",o),_.setAttribute("y2",T),_.setAttribute("stroke","#aaaaaa"),_.setAttribute("stroke-width",i*t.GATE_STRUT_WIDTH),s.appendChild(_)}const _=this.createGroup({id:`particles_${this.generateId("gate")}`});for(let e=0;e<t.GATE_PARTICLES;e++){const r=e*t.ANGLE_45*Math.PI/t.ANGLE_180,a=Math.cos(r)*i*t.GATE_PARTICLE_DISTANCE,s=Math.sin(r)*i*t.GATE_PARTICLE_DISTANCE,A=this.createCircle(a,s,i*t.GATE_PARTICLE_SIZE,{fill:"#00ffff",opacity:t.GATE_PARTICLE_OPACITY});_.appendChild(A)}const n=this.createElement("animateTransform");n.setAttribute("attributeName","transform"),n.setAttribute("type","rotate"),n.setAttribute("values","0 0 0;360 0 0"),n.setAttribute("dur",t.GATE_ANIMATION_DURATION_ROTATE),n.setAttribute("repeatCount","indefinite"),_.appendChild(n),s.appendChild(_),s.appendChild(T),s.appendChild(o),s.appendChild(A);const l=this.createElement("animate");l.setAttribute("attributeName","opacity"),l.setAttribute("values",`${t.GATE_PULSE_MIN};${t.GATE_PULSE_MAX};${t.GATE_PULSE_MIN}`),l.setAttribute("dur",t.GATE_ANIMATION_DURATION_PULSE),l.setAttribute("repeatCount","indefinite"),A.appendChild(l);const E=this.createElement("animate");return E.setAttribute("attributeName","opacity"),E.setAttribute("values",`${t.GATE_CORE_PULSE_MIN};${t.GATE_CORE_PULSE_MAX};${t.GATE_CORE_PULSE_MIN}`),E.setAttribute("dur",t.GATE_ANIMATION_DURATION_CORE),E.setAttribute("repeatCount","indefinite"),T.appendChild(E),s}addToLayer(t,e){return this.getLayer(t).appendChild(e),e}clear(){this.svg.innerHTML="",this.layers.clear(),this.defs=this.createDefs(),this.idCounter=0}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createLaserBeam(t,e,r,i,a={}){const s=this.createGroup({id:this.generateId("laser"),...a}),A=this.createElement("line");A.setAttribute("x1",t),A.setAttribute("y1",e),A.setAttribute("x2",r),A.setAttribute("y2",i),A.setAttribute("stroke",a.color||"#ff0000"),A.setAttribute("stroke-width",a.width||3),A.setAttribute("opacity",.9),A.setAttribute("stroke-linecap","round");const o=this.createElement("line");o.setAttribute("x1",t),o.setAttribute("y1",e),o.setAttribute("x2",r),o.setAttribute("y2",i),o.setAttribute("stroke",a.glowColor||"#ffaaaa"),o.setAttribute("stroke-width",2*(a.width||3)),o.setAttribute("opacity",.3),o.setAttribute("stroke-linecap","round");const T=this.createElement("line");T.setAttribute("x1",t),T.setAttribute("y1",e),T.setAttribute("x2",r),T.setAttribute("y2",i),T.setAttribute("stroke","#ffffff"),T.setAttribute("stroke-width",1),T.setAttribute("opacity",.8),T.setAttribute("stroke-linecap","round"),s.appendChild(o),s.appendChild(A),s.appendChild(T);const _=this.createElement("animate");return _.setAttribute("attributeName","opacity"),_.setAttribute("values","0;1;1;0"),_.setAttribute("dur",a.duration||"0.3s"),_.setAttribute("fill","freeze"),s.appendChild(_),setTimeout(()=>{this.remove(s)},1e3*parseFloat(a.duration||"0.3")+100),s}createLaserImpact(e,r,i={}){const a=this.createGroup({id:this.generateId("impact"),transform:`translate(${e}, ${r})`}),s=this.createCircle(0,0,i.size||8,{fill:i.color||"#ffff00",opacity:t.RATIO_OPACITY_HIGH}),A=this.createCircle(0,0,1.5*(i.size||8),{fill:"none",stroke:i.ringColor||"#ff8800","stroke-width":2,opacity:.7});for(let e=0;e<6;e++){const r=e*t.ANGLE_60*Math.PI/t.ANGLE_180,s=2*(i.size||8),A=Math.cos(r)*s,o=Math.sin(r)*s,T=this.createElement("line");T.setAttribute("x1",0),T.setAttribute("y1",0),T.setAttribute("x2",A),T.setAttribute("y2",o),T.setAttribute("stroke","#ffffff"),T.setAttribute("stroke-width",1),T.setAttribute("opacity",.8),T.setAttribute("stroke-linecap","round"),a.appendChild(T)}a.appendChild(A),a.appendChild(s);const o=this.createElement("animateTransform");o.setAttribute("attributeName","transform"),o.setAttribute("type","scale"),o.setAttribute("values","0 0;1.5 1.5;0.5 0.5"),o.setAttribute("dur",i.duration||"0.4s"),o.setAttribute("fill","freeze"),o.setAttribute("additive","sum");const T=this.createElement("animate");return T.setAttribute("attributeName","opacity"),T.setAttribute("values","0;1;0"),T.setAttribute("dur",i.duration||"0.4s"),T.setAttribute("fill","freeze"),a.appendChild(o),a.appendChild(T),setTimeout(()=>{this.remove(a)},1e3*parseFloat(i.duration||"0.4")+100),a}createProjectile(e,r,i="plasma",a={}){const s=this.createGroup({id:this.generateId("projectile"),transform:`translate(${e}, ${r})`,...a});if("plasma"===i){const e=this.createCircle(0,0,3,{fill:"#00ffff",opacity:t.RATIO_OPACITY_HIGH}),r=this.createCircle(0,0,6,{fill:"#00aaff",opacity:.4}),i=this.createCircle(0,0,8,{fill:"none",stroke:"#0088ff","stroke-width":1,opacity:.2});s.appendChild(i),s.appendChild(r),s.appendChild(e)}else if("missile"===i){const t=this.createPath("M -8 0 L 8 -2 L 10 0 L 8 2 Z",{fill:"#666666",stroke:"#aaaaaa","stroke-width":1}),e=this.createCircle(8,0,2,{fill:"#ff4444",opacity:.8}),r=this.createPath("M -8 0 L -15 -1 L -12 0 L -15 1 Z",{fill:"#ff8800",opacity:.7});s.appendChild(r),s.appendChild(t),s.appendChild(e)}else if("railgun"===i){const e=this.createRect(-4,-1,8,2,{fill:"#ffff00",opacity:t.RATIO_OPACITY_HIGH}),r=this.createRect(-6,-2,12,4,{fill:"none",stroke:"#ffff88","stroke-width":1,opacity:.5});s.appendChild(r),s.appendChild(e)}return s}createExplosion(e,r,i=20,a={}){const s=this.createGroup({id:this.generateId("explosion"),transform:`translate(${e}, ${r})`}),A=a.colors||["#ff4444","#ff8800","#ffff00","#ffffff"];for(let e=0;e<4;e++){const r=this.createCircle(0,0,i*(.3+.3*e),{fill:"none",stroke:A[e]||A[A.length-1],"stroke-width":.1*i,opacity:t.RATIO_OPACITY_HIGH-.2*e});s.appendChild(r)}const o=this.createCircle(0,0,.8*i,{fill:"#ffffff",opacity:.8});for(let e=0;e<12;e++){const r=e*t.ANGLE_30*Math.PI/t.ANGLE_180,a=1.2*i,A=Math.cos(r)*a,o=Math.sin(r)*a,T=this.createCircle(A,o,2,{fill:"#ffaa00",opacity:.7});s.appendChild(T)}s.appendChild(o);const T=this.createElement("animateTransform");T.setAttribute("attributeName","transform"),T.setAttribute("type","scale"),T.setAttribute("values","0 0;2 2;1 1"),T.setAttribute("dur",a.duration||"0.8s"),T.setAttribute("fill","freeze"),T.setAttribute("additive","sum");const _=this.createElement("animate");return _.setAttribute("attributeName","opacity"),_.setAttribute("values","0;1;0"),_.setAttribute("dur",a.duration||"0.8s"),_.setAttribute("fill","freeze"),s.appendChild(T),s.appendChild(_),setTimeout(()=>{this.remove(s)},1e3*parseFloat(a.duration||"0.8")+100),s}createShieldEffect(e,r,i=30,a={}){const s=this.createGroup({id:this.generateId("shield"),transform:`translate(${e}, ${r})`}),A=a.color||"#00aaff",o=this.createPath(`M ${i} 0 L ${.5*i} ${.866*i} L ${.5*-i} ${.866*i} \n             L ${-i} 0 L ${.5*-i} ${.866*-i} L ${.5*i} ${.866*-i} Z`,{fill:"none",stroke:A,"stroke-width":2,opacity:.6}),T=this.createCircle(0,0,.9*i,{fill:A,opacity:.1});for(let e=0;e<6;e++){const r=e*t.ANGLE_60*Math.PI/t.ANGLE_180,a=Math.cos(r)*i*.7,o=Math.sin(r)*i*.7,T=this.createElement("line");T.setAttribute("x1",0),T.setAttribute("y1",0),T.setAttribute("x2",a),T.setAttribute("y2",o),T.setAttribute("stroke",A),T.setAttribute("stroke-width",1),T.setAttribute("opacity",.3),s.appendChild(T)}s.appendChild(T),s.appendChild(o);const _=this.createElement("animate");return _.setAttribute("attributeName","opacity"),_.setAttribute("values","0.3;0.8;0.3"),_.setAttribute("dur","1.5s"),_.setAttribute("repeatCount","indefinite"),s.appendChild(_),s}animate(t,e,r=1e3,i="ease-in-out"){const a=this.createElement("animateTransform");return a.setAttribute("attributeName","transform"),a.setAttribute("dur",`${r}ms`),a.setAttribute("fill","freeze"),e.transform&&(a.setAttribute("type",e.transform.type||"translate"),a.setAttribute("values",e.transform.values)),t.appendChild(a),new Promise(t=>{setTimeout(t,r)})}}